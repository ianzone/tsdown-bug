{"version":3,"file":"next-tick.js","names":["cb: TFunc","ctx?: Record<string, any>","pageElement: TaroRootElement | null"],"sources":["../src/next-tick.ts"],"sourcesContent":["import { Current } from './current'\nimport { TaroRootElement } from './dom/root'\nimport env from './env'\n\nimport type { TFunc } from './interface'\n\nconst TIMEOUT = 100\n\nexport const nextTick = (cb: TFunc, ctx?: Record<string, any>) => {\n  const beginTime = Date.now()\n  const router = Current.router\n\n  const timerFunc = () => {\n    setTimeout(function () {\n      ctx ? cb.call(ctx) : cb()\n    }, 1)\n  }\n\n  if (router === null) return timerFunc()\n\n  const path = router.$taroPath\n\n  /**\n   * 三种情况\n   *   1. 调用 nextTick 时，pendingUpdate 已经从 true 变为 false（即已更新完成），那么需要光等 100ms\n   *   2. 调用 nextTick 时，pendingUpdate 为 true，那么刚好可以搭上便车\n   *   3. 调用 nextTick 时，pendingUpdate 还是 false，框架仍未启动更新逻辑，这时最多轮询 100ms，等待 pendingUpdate 变为 true。\n   */\n  function next () {\n    const pageElement: TaroRootElement | null = env.document.getElementById<TaroRootElement>(path)\n    if (pageElement?.pendingUpdate) {\n      if (process.env.TARO_PLATFORM === 'web') {\n        // eslint-disable-next-line dot-notation\n        pageElement.firstChild?.['componentOnReady']?.().then(() => {\n          timerFunc()\n        }) ?? timerFunc()\n      } else {\n        pageElement.enqueueUpdateCallback(cb, ctx)\n      }\n    } else if (Date.now() - beginTime > TIMEOUT) {\n      timerFunc()\n    } else {\n      setTimeout(() => next(), 20)\n    }\n  }\n\n  next()\n}\n"],"mappings":";;;;AAMA,MAAM,UAAU;AAEhB,MAAa,WAAW,CAACA,IAAWC,QAA8B;CAChE,MAAM,YAAY,KAAK,KAAK;CAC5B,MAAM,SAAS,QAAQ;CAEvB,MAAM,YAAY,MAAM;AACtB,aAAW,WAAY;AACrB,SAAM,GAAG,KAAK,IAAI,GAAG,IAAI;EAC1B,GAAE,EAAE;CACN;AAED,KAAI,WAAW,KAAM,QAAO,WAAW;CAEvC,MAAM,OAAO,OAAO;;;;;;;CAQpB,SAAS,OAAQ;EACf,MAAMC,cAAsC,YAAI,SAAS,eAAgC,KAAK;AAC9F,MAAI,aAAa,eAAe;AAC9B,OAAI,QAAQ,IAAI,kBAAkB,OAAO;AAEvC,gBAAY,aAAa,uBAAuB,CAAC,KAAK,MAAM;AAC1D,gBAAW;IACZ,EAAC,IAAI,WAAW;GAClB,OAAM;AACL,gBAAY,sBAAsB,IAAI,IAAI;GAC3C;EACF,WAAU,KAAK,KAAK,GAAG,YAAY,SAAS;AAC3C,cAAW;EACZ,OAAM;AACL,cAAW,MAAM,MAAM,EAAE,GAAG;EAC7B;CACF;AAED,OAAM;AACP"}